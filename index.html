<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Multi-Tenant Chatbot - Panel de Control</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Panel de Control Multi-Tenant para gesti√≥n de chatbots y documentos">
</head>
<body>
    <div class="container">
        <!-- Header Component -->
        <header class="main-header">
            <div class="header-content">
                <h1 class="main-title">
                    <span class="title-icon">üè¢</span>
                    Panel de Control Multi-Tenant
                </h1>
                <div class="company-selector" id="companySelector">
                    <label for="currentCompany">Empresa Activa:</label>
                    <select id="currentCompany" class="company-select">
                        <option value="">Cargando empresas...</option>
                    </select>
                    <button id="refreshCompanies" class="btn btn-secondary btn-icon">
                        <span class="btn-text">Actualizar</span>
                        <span class="btn-icon">üîÑ</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Company Status Section -->
        <section class="status-section" id="statusSection">
            <div class="card status-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="card-icon">üìä</span>
                        Estado de la Empresa
                    </h2>
                </div>
                <div class="card-body">
                    <div id="companyInfo" class="company-info">
                        <div class="info-placeholder">
                            <span class="placeholder-icon">üè¢</span>
                            <p>Selecciona una empresa para ver su estado</p>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button id="checkHealthBtn" class="btn btn-secondary">
                            <span class="btn-icon">ü©∫</span>
                            Health Check
                        </button>
                        <button id="viewStatsBtn" class="btn btn-secondary">
                            <span class="btn-icon">üìà</span>
                            Estad√≠sticas
                        </button>
                        <button id="resetCacheBtn" class="btn btn-danger">
                            <span class="btn-icon">üóëÔ∏è</span>
                            Limpiar Cache
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- System Overview -->
        <section class="overview-section" id="overviewSection">
            <div class="card overview-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="card-icon">üåê</span>
                        Vista General del Sistema
                    </h2>
                </div>
                <div class="card-body">
                    <div id="systemOverview" class="system-grid">
                        <div class="grid-placeholder">
                            <span class="placeholder-icon">‚è≥</span>
                            <p>Cargando informaci√≥n del sistema...</p>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button id="viewAllCompanies" class="btn btn-primary">
                            <span class="btn-icon">üè¢</span>
                            Ver Todas las Empresas
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Documents Management -->
        <section class="documents-section" id="documentsSection">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">üìÑ</span>
                    Gesti√≥n de Documentos
                </h2>
            </div>
            
            <!-- Add Document Card -->
            <div class="card document-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">‚ûï</span>
                        Agregar Documento
                    </h3>
                </div>
                <div class="card-body">
                    <form id="addDocumentForm" class="document-form">
                        <div class="form-group">
                            <label for="docContent" class="form-label">Contenido del Documento</label>
                            <textarea 
                                id="docContent" 
                                class="form-control form-textarea"
                                placeholder="Escribe o pega el contenido del documento aqu√≠..." 
                                required
                            ></textarea>
                        </div>
                        <div class="form-group">
                            <label for="docMetadata" class="form-label">Metadata (JSON)</label>
                            <input 
                                type="text" 
                                id="docMetadata" 
                                class="form-control"
                                placeholder='{"categoria": "informacion", "tipo": "manual"}'
                            >
                            <small class="form-help">Opcional: metadata en formato JSON para categorizar el documento</small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <span class="btn-icon">üìÑ</span>
                                Agregar Documento
                            </button>
                            <span class="company-indicator">
                                Para empresa: <strong id="docCompanyIndicator">-</strong>
                            </span>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Bulk Upload Card -->
            <div class="card document-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">üìÅ</span>
                        Subir M√∫ltiples Documentos
                    </h3>
                </div>
                <div class="card-body">
                    <form id="bulkUploadForm" class="document-form">
                        <div class="form-group">
                            <label for="bulkFiles" class="form-label">Seleccionar Archivos</label>
                            <input 
                                type="file" 
                                id="bulkFiles" 
                                class="form-control form-file"
                                multiple 
                                accept=".txt,.md,.docx,.pdf"
                            >
                            <small class="form-help">Formatos soportados: TXT, MD, DOCX, PDF</small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <span class="btn-icon">üì§</span>
                                Subir Archivos
                            </button>
                            <span class="company-indicator">
                                Para empresa: <strong id="bulkCompanyIndicator">-</strong>
                            </span>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Search Documents Card -->
            <div class="card document-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">üîç</span>
                        Buscar Documentos
                    </h3>
                </div>
                <div class="card-body">
                    <form id="searchDocumentsForm" class="document-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="searchQuery" class="form-label">Consulta de B√∫squeda</label>
                                <input 
                                    type="text" 
                                    id="searchQuery" 
                                    class="form-control"
                                    placeholder="Buscar en documentos..." 
                                    required
                                >
                            </div>
                            <div class="form-group form-group-small">
                                <label for="searchK" class="form-label">Resultados</label>
                                <input 
                                    type="number" 
                                    id="searchK" 
                                    class="form-control"
                                    value="3" 
                                    min="1" 
                                    max="20"
                                >
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <span class="btn-icon">üîç</span>
                                Buscar
                            </button>
                            <span class="company-indicator">
                                En empresa: <strong id="searchCompanyIndicator">-</strong>
                            </span>
                        </div>
                    </form>
                    <div id="searchResults" class="search-results"></div>
                </div>
            </div>

            <!-- Documents List Card -->
            <div class="card document-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">üìã</span>
                        Documentos Almacenados
                    </h3>
                    <div class="card-actions">
                        <button id="refreshDocsList" class="btn btn-secondary btn-sm">
                            <span class="btn-icon">üîÑ</span>
                            Actualizar
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="documentsList" class="documents-list">
                        <div class="list-placeholder">
                            <span class="placeholder-icon">üìÑ</span>
                            <p>Selecciona una empresa para ver sus documentos</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chat Testing Section -->
        <section class="chat-section" id="chatSection">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">üí¨</span>
                    Pruebas de Chat
                </h2>
            </div>

            <div class="card chat-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">ü§ñ</span>
                        Probar Chatbot
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chat-config">
                        <div class="form-group">
                            <label for="testUserId" class="form-label">ID de Usuario de Prueba</label>
                            <input 
                                type="text" 
                                id="testUserId" 
                                class="form-control"
                                placeholder="test_user_123" 
                                value="test_user"
                            >
                        </div>
                    </div>
                    
                    <div id="chatMessages" class="chat-messages"></div>
                    
                    <form id="chatTestForm" class="chat-input-form">
                        <div class="input-group">
                            <input 
                                type="text" 
                                id="testMessage" 
                                class="form-control chat-input"
                                placeholder="Escribe un mensaje de prueba..." 
                                required
                            >
                            <button type="submit" class="btn btn-primary">
                                <span class="btn-icon">üì§</span>
                                Enviar
                            </button>
                        </div>
                    </form>

                    <div class="multimedia-controls">
                        <div class="control-group">
                            <label class="form-label">Pruebas Multimedia</label>
                            <div class="button-group">
                                <button id="startVoiceBtn" class="btn btn-secondary btn-sm">
                                    <span class="btn-icon">üéôÔ∏è</span>
                                    Grabar Audio
                                </button>
                                <button id="stopVoiceBtn" class="btn btn-danger btn-sm" style="display: none;">
                                    <span class="btn-icon">‚èπÔ∏è</span>
                                    Detener
                                </button>
                                <button id="captureImageBtn" class="btn btn-secondary btn-sm">
                                    <span class="btn-icon">üì∏</span>
                                    Capturar Imagen
                                </button>
                            </div>
                        </div>
                        
                        <div class="file-inputs">
                            <input type="file" id="voiceFileInput" accept="audio/*" style="display: none;">
                            <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
                            
                            <button onclick="document.getElementById('voiceFileInput').click()" class="btn btn-outline btn-sm">
                                <span class="btn-icon">üéµ</span>
                                Subir Audio
                            </button>
                            <button onclick="document.getElementById('imageFileInput').click()" class="btn btn-outline btn-sm">
                                <span class="btn-icon">üñºÔ∏è</span>
                                Subir Imagen
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Tools Section -->
        <section class="admin-section" id="adminSection">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">‚öôÔ∏è</span>
                    Herramientas de Administraci√≥n
                </h2>
            </div>

            <div class="admin-grid">
                <div class="card admin-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="card-icon">üîß</span>
                            Sistema
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="admin-buttons">
                            <button id="reloadConfigBtn" class="btn btn-warning">
                                <span class="btn-icon">üîÑ</span>
                                Recargar Configuraci√≥n
                            </button>
                            <button id="systemStatsBtn" class="btn btn-info">
                                <span class="btn-icon">üìä</span>
                                Estad√≠sticas del Sistema
                            </button>
                            <button id="runDiagnosticsBtn" class="btn btn-secondary">
                                <span class="btn-icon">üîç</span>
                                Ejecutar Diagn√≥sticos
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card admin-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="card-icon">üóÑÔ∏è</span>
                            Base de Datos Vectorial
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="admin-buttons">
                            <button id="cleanupVectorsBtn" class="btn btn-warning">
                                <span class="btn-icon">üßπ</span>
                                Limpiar Vectores Hu√©rfanos
                            </button>
                            <button id="vectorRecoveryBtn" class="btn btn-danger">
                                <span class="btn-icon">üõ†Ô∏è</span>
                                Forzar Recovery
                            </button>
                            <button id="protectionStatusBtn" class="btn btn-info">
                                <span class="btn-icon">üõ°Ô∏è</span>
                                Estado Protecci√≥n
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card admin-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="card-icon">üìÅ</span>
                            Configuraci√≥n
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="admin-buttons">
                            <button id="exportConfigBtn" class="btn btn-success">
                                <span class="btn-icon">üíæ</span>
                                Exportar Configuraci√≥n
                            </button>
                            <button id="migrationToolBtn" class="btn btn-info">
                                <span class="btn-icon">üîÑ</span>
                                Herramienta de Migraci√≥n
                            </button>
                            <button id="testMultimediaBtn" class="btn btn-secondary">
                                <span class="btn-icon">üé¨</span>
                                Test Multimedia
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modals -->
    <div id="cameraModal" class="modal" style="display: none;">
        <div class="modal-content camera-modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span class="modal-icon">üì∏</span>
                    Capturar Imagen
                </h3>
                <span class="company-context">
                    Para empresa: <strong id="cameraCompany">-</strong>
                </span>
                <button id="closeCameraBtn" class="btn-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="camera-container">
                    <video id="cameraVideo" autoplay muted></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                </div>
            </div>
            <div class="modal-footer">
                <button id="takePictureBtn" class="btn btn-primary">
                    <span class="btn-icon">üì∏</span>
                    Tomar Foto
                </button>
                <button id="cancelCameraBtn" class="btn btn-secondary">
                    <span class="btn-icon">‚ùå</span>
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
            <p id="loadingMessage" class="loading-message">Cargando...</p>
            <div id="loadingProgress" class="loading-progress" style="display: none;">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <span id="progressText" class="progress-text">0%</span>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Recording Status Indicator -->
    <div id="recordingStatus" class="recording-status" style="display: none;">
        <div class="recording-indicator">
            <div class="recording-pulse"></div>
            <span class="recording-text">üéôÔ∏è Grabando...</span>
        </div>
    </div>

    <!-- Scripts - Modularized for better performance -->
    <script src="scripts/config.js"></script>
    <script src="scripts/api.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/companies.js"></script>
    <script src="scripts/documents.js"></script>
    <script src="scripts/chat.js"></script>
    <script src="scripts/multimedia.js"></script>
    <script src="scripts/admin.js"></script>
    <script src="scripts/main.js"></script>
</body>
</html>
