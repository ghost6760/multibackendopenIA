# üîÑ An√°lisis Completo para Migraci√≥n Vue.js 3 
## Multibackend OpenIA - De Vanilla JS a Vue.js 3

---

## üìä **PASO 1: AN√ÅLISIS DEL SCRIPT.JS ACTUAL**

### **üîß Variables Globales del Estado Actual**
```javascript
// Configuraci√≥n API
const API_BASE_URL = window.location.origin;
const DEFAULT_COMPANY_ID = 'benova';

// Estado Global - MIGRAR A PINIA STORE
let currentCompanyId = DEFAULT_COMPANY_ID;
let monitoringInterval = null;
let systemLog = [];
let ADMIN_API_KEY = null;

// Cache - MIGRAR A PINIA STORE
const cache = {
    companies: null,
    systemInfo: null,
    lastUpdate: {}
};
```

### **‚ö° Funciones Globales Identificadas (50+ funciones)**

#### **üîã Core Functions (CR√çTICAS para mantener)**
- `apiRequest(endpoint, options)` - **FUNCI√ìN BASE PARA TODAS LAS APIS**
- `showNotification(message, type, duration)` 
- `addToLog(message, level)`
- `updateLogDisplay()`
- `toggleLoadingOverlay(show)`
- `escapeHTML(text)`
- `formatJSON(obj)`
- `validateCompanySelection()`

#### **üéØ Tab Management (SISTEMA PRINCIPAL)**
- `switchTab(tabName)`
- `loadTabContent(tabName)` 
- `initializeTabs()`
- `updateTabNotificationCount(tabName, count)`
- `refreshActiveTab()`
- `getActiveTab()`

#### **üìä Dashboard Functions**
- `loadDashboardData()`
- `loadSystemInfo()`
- `loadCompaniesStatus()`
- `updateStats()`

#### **üè¢ Company Management**
- `loadCompanies()`
- `handleCompanyChange(companyId)`
- `reloadCompaniesConfig()`

#### **üìÑ Document Management**
- `uploadDocument()`
- `loadDocuments()`
- `searchDocuments()`
- `viewDocument(docId)`
- `deleteDocument(docId)`
- `loadDocumentsTab()`

#### **üí¨ Conversation Management**
- `testConversation()`
- `getConversation()`
- `deleteConversation()`
- `loadConversations()`
- `viewConversationDetail(convId)`
- `deleteConversationFromList(convId)`
- `loadConversationsTab()`

#### **üé§ Multimedia Functions**
- `processAudio()`
- `processImage()`
- `testMultimediaIntegration()`
- `captureScreen()`
- `toggleVoiceRecording()`
- `loadMultimediaTab()`

#### **ü§ñ Prompt Management**
- `loadPromptsTab()`
- `loadCurrentPrompts()`
- `updatePrompt(promptId, content)`
- `resetPrompt(promptId)`
- `previewPrompt(promptId)`
- `showPreviewModal(data)`
- `repairPrompts()`
- `migratePromptsToPostgreSQL()`
- `loadPromptsSystemStatus()`

#### **üè¢ Enterprise Functions**
- `loadEnterpriseTab()`
- `loadEnterpriseCompanies()`
- `createEnterpriseCompany()`
- `viewEnterpriseCompany(companyId)`
- `editEnterpriseCompany(companyId)`
- `saveEnterpriseCompany()`
- `testEnterpriseCompany(companyId)`
- `migrateCompaniesToPostgreSQL()`

#### **üè• Health Check Functions**
- `performHealthCheck()`
- `performCompanyHealthCheck()`
- `checkServicesStatus()`
- `runAutoDiagnostics()`
- `startRealTimeMonitoring()`
- `stopRealTimeMonitoring()`
- `loadHealthCheckTab()`

#### **üîß Admin Functions**
- `runSystemDiagnostics()`
- `clearSystemLog()`
- `loadAdminTab()`

#### **üîë API Key Management**
- `showApiKeyModal()`
- `saveApiKey()`
- `closeApiKeyModal()`
- `testApiKey()`
- `updateApiKeyStatus()`

#### **üéõÔ∏è Modal & UI Functions**
- `closeModal()`
- `setupFileUploadHandlers()`

### **üåê APIs Catalogadas (PRESERVAR EXACTAS)**

#### **Core APIs**
```javascript
GET /api/companies
GET /api/system/info
GET /api/health
GET /api/health/company/:id
```

#### **Document APIs**
```javascript
GET /api/documents
POST /api/documents
DELETE /api/documents/:id
POST /api/documents/search
```

#### **Conversation APIs**
```javascript
GET /api/conversations
POST /api/conversations/test
GET /api/conversations/:userId
DELETE /api/conversations/:userId
```

#### **Multimedia APIs**
```javascript
POST /api/multimedia/audio
POST /api/multimedia/image
GET /api/multimedia/test
```

#### **Prompt APIs**
```javascript
GET /api/prompts
PUT /api/prompts/:id
POST /api/prompts/:id/reset
POST /api/prompts/:id/preview
```

#### **Enterprise APIs (con API Key)**
```javascript
GET /api/enterprise/companies
POST /api/enterprise/companies
GET /api/enterprise/companies/:id
PUT /api/enterprise/companies/:id
POST /api/enterprise/companies/:id/test
```

#### **Admin APIs (con API Key)**
```javascript
GET /api/admin/config
POST /api/admin/diagnostics
GET /api/admin/status
```

### **üèóÔ∏è Estructura HTML Identificada**

#### **Tabs Principales**
- `dashboard` - Dashboard principal
- `documents` - Gesti√≥n de documentos
- `conversations` - Gesti√≥n de conversaciones  
- `multimedia` - Procesamiento multimedia
- `prompts` - Gesti√≥n de prompts
- `admin` - Panel de administraci√≥n
- `enterprise` - Funciones enterprise
- `health` - Health checks

#### **Elementos DOM Cr√≠ticos**
- `#companySelect` - Selector de empresas
- `#notificationContainer` - Contenedor de notificaciones
- `#systemLog` - Log del sistema
- `#loadingOverlay` - Overlay de carga
- `#apiKeyStatus` - Estado del API key
- Cada tab tiene su propio contenedor: `#{tabName}TabContent`

---

## üèóÔ∏è **PASO 2: ESTRUCTURA DE COMPONENTES VUE.JS 3**

### **üìÅ Estructura de Directorios Propuesta**
```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppNotifications.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoadingOverlay.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SystemLog.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompanySelector.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ApiKeyModal.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TabNavigation.vue
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardMain.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SystemInfo.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompaniesStatus.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StatsGrid.vue
‚îÇ   ‚îú‚îÄ‚îÄ companies/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompanyManager.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CompanyList.vue
‚îÇ   ‚îú‚îÄ‚îÄ documents/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocumentsTab.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocumentUpload.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocumentSearch.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocumentList.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DocumentModal.vue
‚îÇ   ‚îú‚îÄ‚îÄ conversations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConversationsTab.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConversationTester.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConversationManager.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConversationList.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ConversationDetail.vue
‚îÇ   ‚îú‚îÄ‚îÄ multimedia/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MultimediaTab.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AudioProcessor.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImageProcessor.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ScreenCapture.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VoiceRecorder.vue
‚îÇ   ‚îú‚îÄ‚îÄ prompts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PromptsTab.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PromptEditor.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PromptPreview.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PromptsStatus.vue
‚îÇ   ‚îú‚îÄ‚îÄ enterprise/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EnterpriseTab.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EnterpriseCompanyList.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EnterpriseCompanyForm.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ EnterpriseCompanyDetail.vue
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminTab.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SystemDiagnostics.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RealTimeMonitoring.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AdminTools.vue
‚îÇ   ‚îî‚îÄ‚îÄ health/
‚îÇ       ‚îú‚îÄ‚îÄ HealthTab.vue
‚îÇ       ‚îú‚îÄ‚îÄ HealthChecker.vue
‚îÇ       ‚îú‚îÄ‚îÄ CompanyHealthChecker.vue
‚îÇ       ‚îî‚îÄ‚îÄ ServicesStatus.vue
‚îú‚îÄ‚îÄ composables/
‚îÇ   ‚îú‚îÄ‚îÄ useApiRequest.js
‚îÇ   ‚îú‚îÄ‚îÄ useNotifications.js
‚îÇ   ‚îú‚îÄ‚îÄ useSystemLog.js
‚îÇ   ‚îú‚îÄ‚îÄ useCompanies.js
‚îÇ   ‚îú‚îÄ‚îÄ useDocuments.js
‚îÇ   ‚îú‚îÄ‚îÄ useConversations.js
‚îÇ   ‚îú‚îÄ‚îÄ useMultimedia.js
‚îÇ   ‚îú‚îÄ‚îÄ usePrompts.js
‚îÇ   ‚îú‚îÄ‚îÄ useEnterprise.js
‚îÇ   ‚îú‚îÄ‚îÄ useAdmin.js
‚îÇ   ‚îú‚îÄ‚îÄ useHealthCheck.js
‚îÇ   ‚îî‚îÄ‚îÄ useFileUpload.js
‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îú‚îÄ‚îÄ app.js          # Estado global principal
‚îÇ   ‚îú‚îÄ‚îÄ companies.js    # Estado de empresas
‚îÇ   ‚îú‚îÄ‚îÄ cache.js        # Sistema de cache
‚îÇ   ‚îî‚îÄ‚îÄ auth.js         # API Key management
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ api.js          # Wrapper para preservar apiRequest exacto
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ helpers.js      # Utilidades (escapeHTML, formatJSON, etc.)
‚îÇ   ‚îî‚îÄ‚îÄ constants.js    # Constantes (API_BASE_URL, etc.)
‚îî‚îÄ‚îÄ styles/
    ‚îú‚îÄ‚îÄ main.css
    ‚îú‚îÄ‚îÄ components.css
    ‚îî‚îÄ‚îÄ tabs.css
```

### **üîÑ Composables Principales**

#### **useApiRequest (CR√çTICO)**
```javascript
// composables/useApiRequest.js
import { ref } from 'vue';
import { useAppStore } from '@/stores/app';

export const useApiRequest = () => {
  const appStore = useAppStore();

  const apiRequest = async (endpoint, options = {}) => {
    const url = `${API_BASE_URL}${endpoint}`;
    
    const defaultHeaders = {
      'Content-Type': 'application/json'
    };
    
    // PRESERVAR EXACTO: Header de company
    if (appStore.currentCompanyId) {
      defaultHeaders['X-Company-ID'] = appStore.currentCompanyId;
    }
    
    // PRESERVAR EXACTO: L√≥gica de headers y body
    const headers = { ...defaultHeaders, ...(options.headers || {}) };
    
    const config = {
      method: options.method || 'GET',
      headers,
      ...options
    };
    
    if (options.body) {
      if (options.body instanceof FormData) {
        delete config.headers['Content-Type'];
        config.body = options.body;
      } else {
        config.body = typeof options.body === 'string' 
          ? options.body 
          : JSON.stringify(options.body);
      }
    }
    
    try {
      appStore.addToLog(`API Request: ${config.method} ${endpoint}`, 'info');
      
      const response = await fetch(url, config);
      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.message || `HTTP ${response.status}: ${response.statusText}`);
      }
      
      appStore.addToLog(`API Response: ${endpoint} - Success`, 'info');
      return data;
      
    } catch (error) {
      appStore.addToLog(`API Error: ${endpoint} - ${error.message}`, 'error');
      throw error;
    }
  };

  return { apiRequest };
};
```

### **üóÑÔ∏è Stores Pinia Principales**

#### **stores/app.js (ESTADO PRINCIPAL)**
```javascript
import { defineStore } from 'pinia';
import { ref, computed, watchEffect } from 'vue';

export const useAppStore = defineStore('app', () => {
  // Variables globales migradas
  const currentCompanyId = ref('benova');
  const monitoringInterval = ref(null);
  const systemLog = ref([]);
  const adminApiKey = ref(null);
  
  // Cache migrado
  const cache = ref({
    companies: null,
    systemInfo: null,
    lastUpdate: {}
  });

  // Funciones de log
  const addToLog = (message, level = 'info') => {
    const timestamp = new Date().toISOString().substring(0, 19).replace('T', ' ');
    const logEntry = { timestamp, level, message };
    
    systemLog.value.push(logEntry);
    
    if (systemLog.value.length > 100) {
      systemLog.value.shift();
    }
  };

  const clearSystemLog = () => {
    systemLog.value = [];
    addToLog('System log cleared', 'info');
  };

  // MANTENER COMPATIBILIDAD GLOBAL
  watchEffect(() => {
    window.currentCompanyId = currentCompanyId.value;
    window.systemLog = systemLog.value;
    window.cache = cache.value;
    window.ADMIN_API_KEY = adminApiKey.value;
  });

  return {
    currentCompanyId,
    monitoringInterval,
    systemLog,
    adminApiKey,
    cache,
    addToLog,
    clearSystemLog
  };
});
```

---

## üîÑ **PASO 3: PLAN DE MIGRACI√ìN FUNCI√ìN POR FUNCI√ìN**

### **üìã Orden de Migraci√≥n (Por Prioridad)**

#### **FASE 1: CORE SYSTEM (Cr√≠tico)**
1. ‚úÖ `apiRequest` ‚Üí `useApiRequest` composable
2. ‚úÖ Variables globales ‚Üí Pinia stores
3. ‚úÖ `showNotification` ‚Üí `useNotifications`
4. ‚úÖ `addToLog` / `systemLog` ‚Üí Store integrado
5. ‚úÖ `switchTab` ‚Üí Vue router o state management

#### **FASE 2: COMPANY MANAGEMENT**
6. ‚úÖ `loadCompanies` ‚Üí `useCompanies` composable
7. ‚úÖ `handleCompanyChange` ‚Üí Reactive store management
8. ‚úÖ Company selector ‚Üí `CompanySelector.vue` componente

#### **FASE 3: TAB CONTENT LOADERS**
9. ‚úÖ `loadTabContent` ‚Üí Vue router navigation guards
10. ‚úÖ `loadDashboardData` ‚Üí `DashboardMain.vue`
11. ‚úÖ `loadSystemInfo` ‚Üí `SystemInfo.vue` componente
12. ‚úÖ `loadCompaniesStatus` ‚Üí `CompaniesStatus.vue`

#### **FASE 4: DOCUMENT SYSTEM**
13. ‚úÖ `uploadDocument` ‚Üí `useDocuments` composable
14. ‚úÖ `loadDocuments` ‚Üí `DocumentList.vue` componente
15. ‚úÖ `searchDocuments` ‚Üí `DocumentSearch.vue`
16. ‚úÖ `viewDocument` / `deleteDocument` ‚Üí Modal components

#### **FASE 5: CONVERSATION SYSTEM**
17. ‚úÖ `testConversation` ‚Üí `ConversationTester.vue`
18. ‚úÖ `loadConversations` ‚Üí `ConversationList.vue`
19. ‚úÖ `viewConversationDetail` ‚Üí `ConversationDetail.vue`

#### **FASE 6: MULTIMEDIA & PROMPTS**
20. ‚úÖ Multimedia functions ‚Üí `MultimediaTab.vue`
21. ‚úÖ Prompt management ‚Üí `PromptsTab.vue`

#### **FASE 7: ENTERPRISE & ADMIN**
22. ‚úÖ Enterprise functions ‚Üí `EnterpriseTab.vue`
23. ‚úÖ Admin functions ‚Üí `AdminTab.vue`
24. ‚úÖ Health check ‚Üí `HealthTab.vue`

### **üõ°Ô∏è Wrapper Functions (PRESERVAR COMPATIBILIDAD)**

Para cada funci√≥n migrada, crear wrapper global:

```vue
<!-- Ejemplo: DocumentsTab.vue -->
<script setup>
import { onMounted, onUnmounted } from 'vue';
import { useDocuments } from '@/composables/useDocuments';

const { uploadDocument, loadDocuments, searchDocuments, viewDocument, deleteDocument } = useDocuments();

// WRAPPERS PARA MANTENER COMPATIBILIDAD
onMounted(() => {
  window.uploadDocument = uploadDocument;
  window.loadDocuments = loadDocuments;
  window.searchDocuments = searchDocuments;
  window.viewDocument = viewDocument;
  window.deleteDocument = deleteDocument;
});

onUnmounted(() => {
  delete window.uploadDocument;
  delete window.loadDocuments;
  delete window.searchDocuments;
  delete window.viewDocument;
  delete window.deleteDocument;
});
</script>
```

---

## ‚ö° **PASO 4: WRAPPERS DE COMPATIBILIDAD**

### **üéØ Funciones que REQUIEREN Wrappers Globales**

Todas las funciones que est√°n en `window.*` deben mantenerse:

```javascript
// Lista completa de funciones a preservar en window
window.captureScreen = captureScreen;
window.toggleVoiceRecording = toggleVoiceRecording;
window.switchTab = switchTab;
window.loadTabContent = loadTabContent;
window.initializeTabs = initializeTabs;
// ... (todas las 50+ funciones)
```

### **üîÑ Patr√≥n de Wrapper Est√°ndar**

```javascript
// En cada componente Vue
onMounted(() => {
  // Exponer funciones al √°mbito global
  window.functionName = localVueFunction;
});

onUnmounted(() => {
  // Limpiar referencias globales
  delete window.functionName;
});
```

---

## ‚úÖ **PASO 5: TESTING DE COMPATIBILIDAD**

### **üß™ Tests a Realizar**

#### **API Compatibility Tests**
```javascript
// Verificar que cada endpoint se llama exactamente igual
const testApiCompatibility = async () => {
  // Test original vs Vue implementation
  const originalResponse = await originalApiRequest('/api/companies');
  const vueResponse = await useApiRequest().apiRequest('/api/companies');
  
  console.assert(
    JSON.stringify(originalResponse) === JSON.stringify(vueResponse),
    'API responses must be identical'
  );
};
```

#### **Function Compatibility Tests**
```javascript
// Verificar que cada funci√≥n global existe
const testGlobalFunctions = () => {
  const requiredFunctions = [
    'switchTab', 'loadTabContent', 'uploadDocument',
    'loadDocuments', 'testConversation', 'showNotification'
    // ... todas las funciones
  ];
  
  requiredFunctions.forEach(fnName => {
    console.assert(
      typeof window[fnName] === 'function',
      `Global function ${fnName} must exist`
    );
  });
};
```

#### **State Compatibility Tests**
```javascript
// Verificar que el estado global se mantiene
const testGlobalState = () => {
  console.assert(
    window.currentCompanyId !== undefined,
    'currentCompanyId must be globally accessible'
  );
  
  console.assert(
    Array.isArray(window.systemLog),
    'systemLog must be globally accessible array'
  );
};
```

---

## üìä **RESUMEN DE LA MIGRACI√ìN**

### **‚úÖ Funcionalidad Preservada al 100%**
- ‚úÖ Todas las APIs mantienen formato exacto
- ‚úÖ Todas las funciones globales disponibles
- ‚úÖ Comportamiento id√©ntico del usuario
- ‚úÖ Backend sin modificaciones
- ‚úÖ Estado global sincronizado

### **üöÄ Beneficios de Vue.js 3**
- ‚úÖ C√≥digo modular y mantenible
- ‚úÖ Composition API como Chatwoot
- ‚úÖ Gesti√≥n de estado reactivo con Pinia
- ‚úÖ Componentes reutilizables
- ‚úÖ Preparado para integraci√≥n Chatwoot

### **‚ö†Ô∏è Puntos Cr√≠ticos**
- ‚ùó Nunca modificar formato de APIs
- ‚ùó Preservar nombres exactos de funciones
- ‚ùó Mantener variables globales sincronizadas
- ‚ùó Testing exhaustivo antes de deploy

### **üìà Siguientes Pasos**
1. **Configurar proyecto Vue.js 3** con Vite + Pinia
2. **Migrar por fases** siguiendo el plan establecido
3. **Testing continuo** de compatibilidad
4. **Deploy gradual** tab por tab
5. **Preparaci√≥n para Chatwoot** integration

---

**üéØ OBJETIVO CUMPLIDO: Plan completo de migraci√≥n que preserva 100% de funcionalidad mientras moderniza la arquitectura a Vue.js 3 + Composition API.**
